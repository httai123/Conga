WITH C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985874 AS (
    SELECT msisdn, datetime_tuition_lastest_potential_moment_sms_monthly AS datetime_tuition_lastest_potential_moment_sms_monthly 
FROM C360_FLAT_SERVICES 
WHERE PARTITION_DATE >= LEAST(DATE_FORMAT(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 3 MONTH, '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')) 
      AND PARTITION_DATE <= LEAST(DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') ), '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')) 
      AND PARTITION_DATE IN (
    LEAST(DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') ), '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 1 MONTH), '%Y%m%d'),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 2 MONTH), '%Y%m%d'),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 3 MONTH), '%Y%m%d')
)
), C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985875 AS (
    SELECT msisdn, date_tuition_next_bill_monthly AS date_tuition_next_bill_monthly 
FROM C360_FLAT_SERVICES 
WHERE PARTITION_DATE >= LEAST(DATE_FORMAT(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 3 MONTH, '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')) 
      AND PARTITION_DATE <= LEAST(DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') ), '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')) 
      AND PARTITION_DATE IN (
    LEAST(DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') ), '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 1 MONTH), '%Y%m%d'),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 2 MONTH), '%Y%m%d'),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 3 MONTH), '%Y%m%d')
)
), C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985873 AS (
    SELECT msisdn, cal_tuition_count_sms_received_monthly AS cal_tuition_count_sms_received_monthly 
FROM C360_FLAT_SERVICES 
WHERE PARTITION_DATE >= LEAST(DATE_FORMAT(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 3 MONTH, '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')) 
      AND PARTITION_DATE <= LEAST(DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') ), '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')) 
      AND PARTITION_DATE IN (
    LEAST(DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') ), '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 1 MONTH), '%Y%m%d'),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 2 MONTH), '%Y%m%d'),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 3 MONTH), '%Y%m%d')
)
), C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985880 AS (
    SELECT msisdn, cal_tuition_count_evt_monthly AS cal_tuition_count_evt_monthly 
FROM C360_FLAT_SERVICES 
WHERE PARTITION_DATE >= LEAST(DATE_FORMAT(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 3 MONTH, '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')) 
      AND PARTITION_DATE <= LEAST(DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') ), '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')) 
      AND PARTITION_DATE IN (
    LEAST(DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') ), '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 1 MONTH), '%Y%m%d'),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 2 MONTH), '%Y%m%d'),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 3 MONTH), '%Y%m%d')
)
), C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985878 AS (
    SELECT msisdn, cal_tuition_count_urlopen_monthly AS cal_tuition_count_urlopen_monthly 
FROM C360_FLAT_SERVICES 
WHERE PARTITION_DATE >= LEAST(DATE_FORMAT(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 3 MONTH, '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')) 
      AND PARTITION_DATE <= LEAST(DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') ), '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')) 
      AND PARTITION_DATE IN (
    LEAST(DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') ), '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 1 MONTH), '%Y%m%d'),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 2 MONTH), '%Y%m%d'),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 3 MONTH), '%Y%m%d')
)
), C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985879 AS (
    SELECT msisdn, datetime_tuition_lastest_potential_moment_url_monthly AS datetime_tuition_lastest_potential_moment_url_monthly 
FROM C360_FLAT_SERVICES 
WHERE PARTITION_DATE >= LEAST(DATE_FORMAT(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 3 MONTH, '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')) 
      AND PARTITION_DATE <= LEAST(DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') ), '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')) 
      AND PARTITION_DATE IN (
    LEAST(DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') ), '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 1 MONTH), '%Y%m%d'),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 2 MONTH), '%Y%m%d'),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 3 MONTH), '%Y%m%d')
)
), C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985876 AS (
    SELECT msisdn, amount_sum_tuition_next_bill_monthly AS amount_sum_tuition_next_bill_monthly 
FROM C360_FLAT_SERVICES 
WHERE PARTITION_DATE >= LEAST(DATE_FORMAT(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 3 MONTH, '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')) 
      AND PARTITION_DATE <= LEAST(DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') ), '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')) 
      AND PARTITION_DATE IN (
    LEAST(DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') ), '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 1 MONTH), '%Y%m%d'),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 2 MONTH), '%Y%m%d'),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 3 MONTH), '%Y%m%d')
)
), C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985877 AS (
    SELECT msisdn, datetime_tuition_lastest_potential_moment_evt_monthly AS datetime_tuition_lastest_potential_moment_evt_monthly 
FROM C360_FLAT_SERVICES 
WHERE PARTITION_DATE >= LEAST(DATE_FORMAT(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 3 MONTH, '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')) 
      AND PARTITION_DATE <= LEAST(DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') ), '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')) 
      AND PARTITION_DATE IN (
    LEAST(DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') ), '%Y%m%d'), DATE_FORMAT(CURDATE() - INTERVAL 1 DAY, '%Y%m%d')),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 1 MONTH), '%Y%m%d'),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 2 MONTH), '%Y%m%d'),
	DATE_FORMAT(LAST_DAY(CONCAT(DATE_FORMAT(CURDATE(), '%Y%m'), '01') - INTERVAL 3 MONTH), '%Y%m%d')
)
), id_1746494985922 AS (
    SELECT C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985873.msisdn AS msisdn 
FROM C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985873  
WHERE (C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985873.cal_tuition_count_sms_received_monthly >= 10) 
GROUP BY C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985873.msisdn 
HAVING COUNT(*) >= 1
), id_1746494985923 AS (
    SELECT C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985874.msisdn AS msisdn 
FROM C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985874  
WHERE (C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985874.datetime_tuition_lastest_potential_moment_sms_monthly != CURRENT_TIMESTAMP() - INTERVAL 45 SECOND) 
GROUP BY C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985874.msisdn 
HAVING COUNT(*) >= 1
), id_1746494985925 AS (
    SELECT C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985875.msisdn AS msisdn 
FROM C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985875  
WHERE (C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985875.date_tuition_next_bill_monthly <= CURDATE() - INTERVAL 45 DAY) 
GROUP BY C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985875.msisdn 
HAVING COUNT(*) >= 1
), id_1746494985926 AS (
    SELECT C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985876.msisdn AS msisdn 
FROM C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985876  
WHERE (C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985876.amount_sum_tuition_next_bill_monthly > 5000) 
GROUP BY C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985876.msisdn 
HAVING COUNT(*) >= 1
), id_1746494985929 AS (
    SELECT C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985877.msisdn AS msisdn 
FROM C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985877  
WHERE (C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985877.datetime_tuition_lastest_potential_moment_evt_monthly != CURRENT_TIMESTAMP() - INTERVAL 45 SECOND) 
GROUP BY C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985877.msisdn 
HAVING COUNT(*) >= 1
), id_1746494985930 AS (
    SELECT C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985878.msisdn AS msisdn 
FROM C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985878  
WHERE (C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985878.cal_tuition_count_urlopen_monthly >= 2) 
GROUP BY C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985878.msisdn 
HAVING COUNT(*) >= 1
), id_1746494985932 AS (
    SELECT C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985879.msisdn AS msisdn 
FROM C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985879  
WHERE (C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985879.datetime_tuition_lastest_potential_moment_url_monthly != CURDATE() - INTERVAL 45 DAY) 
GROUP BY C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985879.msisdn 
HAVING COUNT(*) >= 1
), id_1746494985933 AS (
    SELECT C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985880.msisdn AS msisdn 
FROM C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985880  
WHERE (C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985880.cal_tuition_count_evt_monthly >= 2) 
GROUP BY C360_FLAT_SERVICES_EXISTS_MONTHLY_RELA_neg_3_0_id_1746494985880.msisdn 
HAVING COUNT(*) >= 1
), id_1746494985931 AS (
    SELECT msisdn FROM (
	SELECT msisdn FROM id_1746494985932
	INTERSECT
	SELECT msisdn FROM id_1746494985933) AS t
), id_1746494985928 AS (
    SELECT msisdn FROM (
	SELECT msisdn FROM id_1746494985929
	INTERSECT
	SELECT msisdn FROM id_1746494985930) AS t
), id_1746494985927 AS (
    SELECT msisdn FROM (
	SELECT msisdn FROM id_1746494985928
	UNION
	SELECT msisdn FROM id_1746494985931) AS t
), id_1746494985924 AS (
    SELECT msisdn FROM (
	SELECT msisdn FROM id_1746494985925
	INTERSECT
	SELECT msisdn FROM id_1746494985926) AS t
), id_1746494985921 AS (
    SELECT msisdn FROM (
	SELECT msisdn FROM id_1746494985922
	INTERSECT
	SELECT msisdn FROM id_1746494985923) AS t
), id_1746494985920 AS (
    SELECT msisdn FROM (
	SELECT msisdn FROM id_1746494985921
	UNION
	SELECT msisdn FROM id_1746494985924) AS t
) 
SELECT msisdn FROM (
	SELECT msisdn FROM id_1746494985920
	INTERSECT
	SELECT msisdn FROM id_1746494985927) AS t